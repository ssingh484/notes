** Talk given by 6Mile**

Gimme Patz for patz

super-confused: dep confusion analysis tool

MALOSS - Identify Malicious Open-Source Software

EDR does not understand interpreted langs, like Javascript malware

# Types of vulns

## Accidentally Vulnerable
- Accidentally created by devs
- Stands out in source code
- Think OWASP Top 10
- Auth Bypass/Isues
- Out of date Libraries
- Produces **Findings**

Intentionally Malicious
- Created by Criminals
- Tries really hard to hide
- Native JS Payloads
- C2 & Exfil still ala Binary Malware
- Install scripts is RCE by design
- Produces: **Decisions about packages - good? bad???**

Threat Intel isn't really provided by usual tools

# What makes something malicious

## Per OpenSSF:

Something that introduces malware or backdoors and targets networks
Steals sensitive information
Gain unauth access
Consume compute (Cryptomining)
Damage or Destroy data (Ransomware)

# Why Javascript malware diff

- Doesn't detonate like traditional malware (binaries)
- Skills for binary mal analysis don't necessarily cross over
- Software package as atomic unit means that vuln data and malicious data is stored together
# NPM

- The CLI is separate API than rest of NPM which is weird
- World's largest and world's most insecure registry
- NPM has systemic flaws, built in a time "before sec"
- Install scripts - RCE by design
- Low Barrier to entry
- Anyone can claim a namespace
- PKG metadata can be faked including downloads, repo, auth and more!!
- From scratch - gmail, github npm account (3 minutes) : super low barrier to entry
- **Sonatype in 2024: 98.5% of all mal packages are served by NPM**
- Javascript due to its design has 10X the numer of deps as the next highest language by deps needed (avg direct top-level deps in projects)

# Finding Open Source Malware

- [https://osv.dev](https://osv.dev) : easy catallogue of malicious npm packages
- Usually like a 30-ish day timeline from package being malicious and made/published to getting a SNYK/GHAS finding

# How does this malware evade EDR? Sec Tools?
- No binaries in the packages
- File hashing and disassembly are useless
- highly iterative files so payloads, exfil, etc changes all the time
- Sandboxes like any.run, Joe's, Triage doesn't really help
- Obfuscation is not a sign of malware
- Obfuscation can be IP protection and often totally legitimate in JS
- Many obfuscation techniques and need human to get involved
- Lot of it runs in browser, can target devs web-apps and backends
- Can access tokens, cookies etc
- **NO EDR/IDS in CI/CD pipelines/runners**
- Calls libs and containers with no oversight
- No logging, or logging ignored
- lots of IP and access combined

# Making Open-Source Malware?
- Just stay out of GHSA and OSV - only those 2 used by most security vendors to front their SCA

# Exercise NPM CLI:

- `npm view PACKAGE --json` - let's you see package metadata
	- eg: `npm view express-exp --json`
	- We can see the version `0.0.1-security`
	- we can see description `security holding package`
	- Examined https://registry.npmjs.org/react-native-kraken-oauth/-/react-native-kraken-oauth-1.0.1.tgz
	- Found the code in index.json where hostname and ip pulled
- DO NOT run `npm install`
  
# Why does SCA not help?

- The ~ 30 day or longer window from published->downloaded->marked vuln in tools

# Open Source Malware TTPs

![[Pasted image 20250808141116.png]]
**PBOM.DEV for good threat modeling CI/CD pipelines**

# Dependency-Confusion

- private vs public registry and versions
- AI Slop Squatting (squat generic names)
- typosquat
